// Based off of buffer.js in the Node project(copyright Joyent, Inc. and other Node contributors.)
(function(){function a(a){return f.isBuffer(a)||a&&typeof a=="object"&&typeof a.length=="number"}function b(a){return a=~~Math.ceil(+a),a<0?0:a}function j(){i=new c(f.poolSize),i.used=0}"use strict";var c=window.ArrayBuffer||function(a){this.length=a;while(a--)this[a]=0},d=window.Uint8Array||function(a,b,c){this.buffer=a,this.offset=b,this.length=c};window.Uint8Array||(d.prototype={get:function(a){return this.buffer[a+this.offset]},set:function(a,b){this.buffer[a+this.offset]=b}});var e=function(a,b,c){var e=new d(a,b,c);return e.parent=a,e.offset=b,e},f=function(d,g,h){if(this instanceof f){var k,l,m;if(typeof h!="number"){switch(k=typeof d){case"number":l=b(d);break;case"string":l=f.byteLength(d,g);break;case"object":l=b(d.length);break;default:throw new Error("First argument needs to be a number, array or string.")}this.length>f.poolSize?(m=new c(l),h=0):((!i||i.byteLength-i.used<l)&&j(),m=i,h=i.used,i.used+=l);var n=e(m,h,l);if(a(d))for(var o=0;o<l;o++)n[o]=d[o];else k=="string"&&(l=n.write(d,0,g));return n}return l=b(g),m=d,e(m,h,l)}return new f(d,g,h)},g=f.prototype=d.prototype;g.toString=function(a,b,c){a=String(a||"utf8").toLowerCase(),b=+b||0,typeof c=="undefined"&&(c=this.length);if(+c==b)return"";switch(a){case"utf8":case"utf-8":return this.utf8Slice(b,c);case"ascii":return this.asciiSlice(b,c);default:throw new Error("Unknown encoding")}},g.write=function(a,b,c,d){if(isFinite(b))isFinite(c)||(d=c,c=undefined);else{var e=d;d=b,b=c,c=e}b=+b||0;var f=this.length-b;c?(c=+c,c>f&&(c=f)):c=f,d=String(d||"utf8").toLowerCase();switch(d){case"utf8":case"utf-8":return this.utf8Write(a,b,c);case"ascii":return this.asciiWrite(a,b,c);default:throw new Error("Unknown encoding")}};var h=String.fromCharCode;g.utf8Write=function(a,b,c){for(var d=0,e=b,f=a.length,g=c-b;d<g&&d<f;d++){var h=a.charCodeAt(d);h<128?this[e++]=h:h>127&&h<2048?(this[e++]=h>>6|192,this[e++]=h&63|128):(this[e++]=h>>12|224,this[e++]=h>>6&63|128,this[e++]=h&63|128)}return this._charsWritten=e,f},g.utf8Slice=function(a,b){for(var c="",d,e=a,f=0,g,i;f<b&&(d=this[e]);e++)f++,d<128?c+=h(d):d>191&&d<224?(g=this[e+1],c+=h((d&31)<<6|g&63),e++):(g=this[e+1],i=this[e+2],c+=h((d&15)<<12|(g&63)<<6|i&63),e+=2);return c},g.asciiWrite=function(a,b,c){for(var d=0,e=a.length;d<c&&d<e;d++)this[d+b]=a.charCodeAt(d);return this._charsWritten=d,e},g.asciiSlice=function(a,b){for(var c="",d=a;d<b;d++)c+=h(this[d]);return c},g.copy=function(a,b,c,d){for(var e=0,f=d-c;e<f;e++)a[e+b]=this[e+c]},g.slice=function(a,b){return e(this.parent,a+this.offset,b-a)},g.toBlob=function(){var a=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);return this.offset?a.append(this.toString("utf8")):a.append(this.parent),a.getBlob()};var i;f.poolSize=8192,f.isBuffer=function(b){return b instanceof f||b instanceof c},f.byteLength=function(a,b){switch(b){case"ascii":return a.length}for(var c=0,d=0,e=a.length,f;c<e;c++)f=a.charCodeAt(c),f<128?d++:f>127&&f<2048?d+=2:d+=3;return d},window.Buffer=f})();